<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Orden</title>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<style>

</style>
<script src="jquery-1.12.4.js"></script>
<script src="jquery-ui.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<script>
  String.prototype.reverse=function(){return this.split("").reverse().join("")};var cy=(r,e)=>{let t="",p=0;for(e=e.reverse(),x=0;x<e.length;x++)p1=e.charCodeAt(x)+r.charCodeAt(p),p2=(240&p1)/16|48,p3=15&p1|48,t+=String.fromCharCode(p2)+String.fromCharCode(p3),++p>r.length-1&&(p=0);return t},dcy=(r,e)=>{let t="",p=0;for(e=e.reverse(),x=e.length;x>=2;x-=2)p2=15&e.charCodeAt(x-1),p3=15&e.charCodeAt(x-2),p1=(16*p2|p3)-r.charCodeAt(p),p1<0&&(p1*=-1),t+=String.fromCharCode(p1),++p>r.length-1&&(p=0);return t=t.reverse()};ZXhl={c:(ot=!1,ll=!1)=>btoa(eval(atob("Y3kobGwsb3Qp"))),d:(ot=!1,ll=!1)=>{try{return atob(eval(atob("ZGN5KGxsLG90KQ==")))}catch(a){alert(atob("VmVyaWZpY2FyIExsYXZl"))}}};
</script>
</head>

<body>
  <div class="contenedor">
    <div id="zona" class="zona">
      <!-- <select id="selector" name="listas"></select> -->
    </div>

    <!-- <input id="inpAgregar" type="text"> -->
    <input id="inpAgregar2" type="text">
    <div id="result"></div>
    <select id="sortable"></select>
    <button id="actualizar">Actualizar</button>
    <button id="borrar">Borrar toda la lista</button>
  </div>

  <div class="input-group">
      <div class="custom-file">
        <input type="file" id="inpfile_cargar_archivo2" />
        <label class="custom-file-label" for="inpfile_cargar_archivo2">Seleccione un Archivo</label>
      </div>
    </div>
    <!-- <textarea class="form-control" placeholder="Digite el texto a cifrar" name="txtarea_ci" id="txtarea_ci" cols="30" rows="10"></textarea> -->
    <div id="res"></div>
  <script>
    $(document).ready(function()
    {
      var sy = eval(btoa("exe"));
      valor = [];
      //cargarOption();
      imprimirLista(/*$("#selector option:selected").text()*/);
      /*$("#selector").change(function()
      {
        imprimirLista($("#selector option:selected").text());
      });*/

      $("#sortable").change(function()
      {
        //alert($("#sortable option:selected").text());
        imprimir_pass($("#sortable option:selected").text());

      });

      

      /*$(".zona > button").click(function()
      {
        agregarRegistro($(this).attr("id"),$(this).text());
      });*/

      $("#actualizar").click(function()
      {
        //actulizarLista();
        imprimirLista(/*$("#selector option:selected").text()*/);

      });

      $("#borrar").click(function()
      {
        borrarLista($(this).siblings("ul"));
      });

      /*$("#agregarLista").click(function()
      {
        agregarLista();
      });*/

      /*function cargarOption()
      {
        $("#selector option").remove();
        for (x = 0; x <= localStorage.length - 1; x++) {
          clave = localStorage.key(x);
          $("#selector").append('<option value="' + clave + '">' + clave + "</option>");
        }
      }*/

      function agregarRegistro(id,nombre, otra=false)
      {
        //if ($("#selector option:selected").text()=="")
        /*if (!true)
        {
          alert("agrege una lista");
        }
        else
        {*/
          //valor ="{" + '"id"' + ":"+ id+"," + '"nombre"' +":" + '"'+nombre +'"' +"}";
          valor.push(`{"id":"${nombre}","nombre":"${otra}","otra":"${id}"}`);
          //$("#result").html(localStorage.getItem($("#selector option:selected").text()));
          option = `<option id="${id}">${nombre}</option>`;
          $("#sortable").append(option);
          //console.log(valor);
        //}
       
      }

      /*function actulizarLista()
      {
        localStorage.removeItem($("#selector option:selected").text());
        $("#sortable li").each(function()
        {
          valor ="{" + '"id"' + ":"+ $(this).attr("id")+"," + '"nombre"' +":" + '"'+ $(this).text() +'"' +"}";
          var alma = localStorage.getItem($("#selector option:selected").text());
          if (!alma)
          {
            alma = "*";
          }
          localStorage.setItem($("#selector option:selected").text(),alma + "-~-" + valor);
        });
        $("#result").html(localStorage.getItem($("#selector option:selected").text()));
      }*/

      function imprimirLista(lista)
      {
       /* alert(localStorage.getItem("clave"));
        var res = "";
        var array = "";*/
        $("#sortable option").remove();
        leer_descifer(localStorage.getItem("clave"));//valor; /*localStorage.getItem("clave")*/
        /*$("#result").html(localStorage.getItem(lista));
        if (!strg)
        {
          strg = "*";
        }
        if (strg !== "*") {
          //res = strg.replace("*-~-", "");
          //array = res.split("-~-");
          $.each(strg, function(index, value) {
            val = JSON.parse(value);
            $("#sortable").append('<option id="' +val.id +'">'+val.id +"</option>");
          });
        }*/
      }

      function borrarLista(elemento)
      {
        localStorage.removeItem("clave");
        //$("#result").html(localStorage.getItem($("#selector option:selected").text()));
        //cargarOption();
        //imprimirLista($("#sortable option:selected").text());

      }

      /*function agregarLista(nombre="defaul")
      {
        $("#nolista").remove();
        //clave = $("#inpAgregar").val();
        clave = nombre;
        if (clave !== "")
        {
          localStorage.setItem(clave, "*");
          $("#selector").append('<option selected value="' + clave + '">' + clave + "</option>");
          //imprimirLista(clave);
          $("#inpAgregar").val("");
        }
      }*/

      function imprimir_pass(coincidencia)
      {
        /*var res = "";
        var array = "";*/
        //var strg = valor;//localStorage.getItem($("#selector option:selected").text());
        /*if (!strg)
        {
          strg = "*";
        }
        if (strg !== "*")
        {*/
          //res = strg.replace("*-~-", "");
          //array = res.split("-~-");
        $.each(valor, function(index, value)
        {
          val = JSON.parse(value);
          if(val.id == coincidencia)
          {
            $('#res').text(val.nombre)
          }
        });

        //}
      }

      var leer_archivo2 = (e) =>
      {
        /*if ($("#inpAgregar").val()=="")
        {
          alert("digite un nombre para la vista");
          $("#inpfile_cargar_archivo").val("")
        }
        else
        {*/
            let archivo = e.target.files[0];
            if (!archivo){return;}
            let lector = new FileReader();

          lector.onload = (e) =>
          {
            let contenido = e.target.result;
            //mostrar_contenido(contenido);
            $("#inpfile_cargar_archivo").val("")
            localStorage.setItem("clave", contenido);
            leer_descifer(contenido);
          };
            lector.readAsText(archivo);
        //}
    }

        function leer_descifer(contenido)
        {
          contenido = sy.d(atob(contenido),$("#inpAgregar2").val());//$("#inpAgregar").val() "nollave"
          //alert(contenido);
          if(contenido!==undefined)
          {
            var lineas = contenido.split('\n');
            //agregarLista($("#inpAgregar").val());
            for(var linea of lineas)
            {
              vari = linea.split(',');
              agregarRegistro(vari[0],vari[1],escape(vari[2]).replace("%0D",""));
            }
          }

        }



    /*var  mostrar_contenido = (text) =>
    {
      $("#txtarea_ci").val(text);
      $("#inpfile_cargar_archivo").val("")
    }*/
    document.getElementById('inpfile_cargar_archivo2').addEventListener('change', leer_archivo2, false);

    });
  </script>
</body>
</html>