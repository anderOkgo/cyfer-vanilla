<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<title>Cyfer</title>
	<meta name="viewport" content="initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
	<link rel="stylesheet" type="text/css" href="css/datatables.min.css"/>
	<script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="js/datatables.min.js"></script>
	<script type="text/javascript" src="js/FileSaver.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<style>
		.input-group-text
		{
			min-width: 120px;
		}
	</style>
</head>
<body>
	<div class="jumbotron jumbotron-fluid">
		<div class="container">
			<h1 class="display-6">Cifrador</h1>
			<p class="lead">Cifrador Cliente.</p>
		</div>
	</div>

	<div class="container">
		<div class="input-group mb-3">
			<div class="input-group-prepend">
				<span class="input-group-text" id="basic-addon1">Llave</span>
			</div>
			<input type="text" id="inp_llave" class="form-control" placeholder="Llave" value="nollave" aria-label="Username" aria-describedby="basic-addon1">
		</div>
		    
		<div class="input-group mb-3">
			<div class="input-group-prepend">
				<span class="input-group-text">Escriba Tetxo</span>
			</div>
			<textarea class="form-control" placeholder="Digite el texto a cifrar" name="txtarea_ci" id="txtarea_ci" cols="30" rows="10"></textarea>
	  	</div>
	  	<button class="btn btn-outline-success" id="btn_ci">Cifrar</button>
	  	<hr>

	  	<div class="input-group mb-3">
			<div class="input-group-prepend">
				<span class="input-group-text">Texto Cifrado</span>
			</div>
			<textarea class="form-control" placeholder="Digite el texto a descifrar" name="txtarea_dci" id="txtarea_dci" cols="30" rows="10"></textarea>
		</div>
		<br>

		<button class="btn btn-outline-warning" id="btn_dc">Decifrar</button>
		<button class="btn btn-outline-info" id="btn_descargar">Descargar</button>
		<hr>
		<div class="input-group">
			<div class="custom-file">
				<input type="file" id="inpfile_cargar_archivo" />
				<label class="custom-file-label" for="inpfile_cargar_archivo">Seleccione un Archivo</label>
			</div>
		</div>
	</div>
</body>

<script>
	$(document).ready(function()
	{
		var sy = eval(btoa("exe"));
    	var leer_archivo = (e) =>
    	{
			let archivo = e.target.files[0];
			if (!archivo){return;}
			let lector = new FileReader();
			lector.onload = (e) =>
			{
				let contenido = e.target.result;
				mostrar_contenido(atob(contenido));
			};
	  		lector.readAsText(archivo);
		}

		var  mostrar_contenido = (text) =>
		{
			let llave = $("#inp_llave").val();
			$("#txtarea_ci").val(sy.d(text,$("#inp_llave").val()));
		}

		$("#btn_descargar").click(function()
    	{
    		$("#txtarea_dci").val(sy.c(btoa($("#txtarea_ci").val()),$("#inp_llave").val()));
			let text = $("#txtarea_dci").val();
			let blob = new Blob([text], {type: "text/plain;charset=utf-8"});
			saveAs(blob, "Cyfer.txt");
		});

		$('#btn_ci').click(function(){
			$("#txtarea_dci").val(sy.c(btoa($("#txtarea_ci").val()),$("#inp_llave").val()));
		});

		$('#btn_dc').click(function(){
			$("#txtarea_ci").val(sy.d(atob($("#txtarea_dci").val()),$("#inp_llave").val()));
		});

		document.getElementById('inpfile_cargar_archivo').addEventListener('change', leer_archivo, false);
	});
</script>
</html>