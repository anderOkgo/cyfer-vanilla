<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<title>Cyfer</title>
	<meta name="viewport" content="initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
	<link rel="stylesheet" type="text/css" href="css/datatables.min.css"/>
	<script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="js/datatables.min.js"></script>
	<script type="text/javascript" src="js/FileSaver.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<style>
		.input-group-text
		{
			min-width: 120px;
		}
	</style>
</head>
<body>
	<div class="jumbotron jumbotron-fluid">
		<div class="container">
			<h1 class="display-6">Cifrador</h1>
			<p class="lead">Cifrador Cliente.</p>
		</div>
	</div>

	<div class="container">
		<div class="input-group mb-3">
			<div class="input-group-prepend">
				<span class="input-group-text" id="basic-addon1">Llave</span>
			</div>
			<input type="text" id="inp_llave" class="form-control" placeholder="Llave" value="nollave" aria-label="Username" aria-describedby="basic-addon1">
		</div>
		    
		<div class="input-group mb-3">
			<div class="input-group-prepend">
				<span class="input-group-text">Escriba Tetxo</span>
			</div>
			<textarea class="form-control" placeholder="Digite el texto a cifrar" name="txtarea_ci" id="txtarea_ci" cols="30" rows="10"></textarea>
	  	</div>
	  	<button class="btn btn-outline-success" id="btn_ci">Cifrar</button>
	  	<hr>

	  	<div class="input-group mb-3">
			<div class="input-group-prepend">
				<span class="input-group-text">Texto Cifrado</span>
			</div>
			<textarea class="form-control" placeholder="Digite el texto a descifrar" name="txtarea_dci" id="txtarea_dci" cols="30" rows="10"></textarea>
		</div>
		<br>

		<button class="btn btn-outline-warning" id="btn_dc">Decifrar</button>
		<button class="btn btn-outline-info" id="btn_descargar">Descargar</button>
		<hr>
		<div class="input-group">
			<div class="custom-file">
				<input type="file" id="inpfile_cargar_archivo" />
				<label class="custom-file-label" for="inpfile_cargar_archivo">Seleccione un Archivo</label>
			</div>
		</div>
	</div>
</body>

<script>
	$(document).ready(function()
	{
		String.prototype.reverse = function() 
		{
			return this.split("").reverse().join("");
		};

		var cy = (ll, ca) =>
		{
			let nc = "";
			let li = 0;
			ca           = ca.reverse();
			for (x = 0; x < ca.length; x++)
			{
				p1 = (ca.charCodeAt(x)) + ll.charCodeAt(li);
				p2 = (((p1 & 240) / 16) | 48);
				p3 = ((p1 & 15) | 48);
				nc += String.fromCharCode(p2) + String.fromCharCode(p3);
				li ++;
				if (li > ll.length - 1){li = 0;}
			}
			return nc;
		}

		var dcy = (ll, ca) =>
		{
			let nc = "";
			let li = 0;
			ca           = ca.reverse();
			for (x = ca.length; x >= 2; x -= 2)
			{
				p2 = (ca.charCodeAt(x - 1) & 15);
				p3 = (ca.charCodeAt(x - 2) & 15);
				p1 = (p2 * 16 | p3) - ll.charCodeAt(li);
				if (p1 < 0){p1 = p1 * (-1)}
				nc += String.fromCharCode(p1);
				li ++;
				if (li > ll.length - 1){li = 0;}
			}
			nc = nc.reverse();
			return nc ;
		}

		var ZXhl = 
		{
			'c':
			(ot = false, ll = false) =>
			{
				return btoa(eval(atob("Y3kobGwsb3Qp")));//cy(ll,ot);
			}
			,"d":

			(ot = false, ll = false) =>
			{
				try 
				{
					return atob(eval(atob("ZGN5KGxsLG90KQ==")));//dcy(llave,text);
				}
				catch (e)
				{
					alert(atob("VmVyaWZpY2FyIExsYXZl"));
				}	
			}
		};
		
    	var leer_archivo = (e) =>
    	{
		  let archivo = e.target.files[0];
			if (!archivo){return;}
			let lector = new FileReader();
			lector.onload = (e) =>
			{
				let contenido = e.target.result;
				mostrar_contenido(atob(contenido));
			};
	  		lector.readAsText(archivo);
		}

		var  mostrar_contenido = (text) =>
		{
			let llave = $("#inp_llave").val();
			$("#txtarea_ci").val(eval(btoa("exe")).d(text,$("#inp_llave").val()));
		}

		$("#btn_descargar").click(function()
    	{
    		$("#txtarea_dci").val((eval(btoa("exe")).c(btoa($("#txtarea_ci").val()),$("#inp_llave").val())));
			let text = $("#txtarea_dci").val();
			let blob = new Blob([text], {type: "text/plain;charset=utf-8"});
			saveAs(blob, "Cyfer.txt");
		});

		$('#btn_ci').click(function(){
			$("#txtarea_dci").val((eval(btoa("exe")).c(btoa($("#txtarea_ci").val()),$("#inp_llave").val())));
		});

		$('#btn_dc').click(function(){
			$("#txtarea_ci").val(eval(btoa("exe")).d(atob($("#txtarea_dci").val()),$("#inp_llave").val()));
		});

		document.getElementById('inpfile_cargar_archivo').addEventListener('change', leer_archivo, false);
	});
</script>
</html>